import React, { useEffect } from 'react';
import PropTypes from 'prop-types';
import { connect } from 'react-redux';

import { gsap } from 'gsap';
import { DrawSVGPlugin } from 'gsap/DrawSVGPlugin';

import { endLoaderAnimation } from '../actions/client';

import '../css/MountbirchLogoAnimation.css';

gsap.registerPlugin(DrawSVGPlugin);

const MountbirchLogoAnimation = ({
  client: { loading },
  endLoaderAnimation,
}) => {
  useEffect(() => {
    if (!loading) {
      gsap.defaults({
        ease: 'linear',
      });

      const timeline = gsap.timeline();
      timeline.repeat(1).yoyo(true);

      const frameStrokeDasharray = 940;

      // core stroke length 861
      const core_p1_strokeDasharray = 768;
      const core_p2_strokeDasharray = 93;
      const core_p3_strokeDasharray = 53;

      const frameStrokeDashDuration = 0.0015;
      const coreStrokeDashDuration =
        (frameStrokeDashDuration * frameStrokeDasharray) / 861;

      const frameDuration = frameStrokeDashDuration * frameStrokeDasharray;

      const coreDuration1 = coreStrokeDashDuration * core_p1_strokeDasharray;
      const coreDuration2 = coreStrokeDashDuration * core_p2_strokeDasharray;
      const coreDuration3 = coreStrokeDashDuration * core_p3_strokeDasharray;

      timeline.from(
        '.mount-birch-logo-animation-wrapper',
        { autoAlpha: 0, duration: 0 },
        '+=0.1'
      );

      timeline.from(
        '#frame-stroke',
        {
          duration: frameDuration,
          drawSVG: '100% 100%',
          onReverseComplete: () => {
            if (loading) {
              timeline.restart();
            } else {
              endLoaderAnimation();
            }
          },
        },
        `<`
      );

      timeline.from(
        '#core-p1-stroke',
        {
          duration: coreDuration1,
          drawSVG: '0% 0%',
        },
        `<`
      );

      timeline.from(
        '#core-p2-stroke',
        {
          duration: coreDuration2,
          drawSVG: '0% 0%',
        },
        `>`
      );

      timeline.from(
        '#core-p3-stroke',
        {
          duration: coreDuration3,
          drawSVG: '0% 0%',
        },
        `<`
      );
    }
  }, [loading, endLoaderAnimation]);

  return (
    <div className='mount-birch-logo-animation-wrapper'>
      <svg
        id='Layer_1'
        data-name='Layer 1'
        xmlns='http://www.w3.org/2000/svg'
        viewBox='0 0 292.96 319.76'
      >
        <defs>
          <clipPath id='mb-clip-path' transform='translate(1.54 1.89)'>
            <path
              id='core-p3-clip'
              className='mb-cls-1'
              d='M199.5,132.1a110.36,110.36,0,0,1,27.56-2.32c6.23.23,12.45.9,18.68,1.31a2.19,2.19,0,0,1,2.37,2.51c0,.83.06,1.67,0,2.5-.29,6.19-1.74,7.24-7.5,5.59-10.51-3-21.27-3.7-33.09-3.33l1.86,2.37-11.54-.23.76-8.21Z'
            />
          </clipPath>
          <clipPath id='mb-clip-path-2' transform='translate(1.54 1.89)'>
            <path
              id='core-p2-clip'
              className='mb-cls-1'
              d='M199.5,132.1c-8.2,1.79-16.48,3.42-24.44,6a275.06,275.06,0,0,0-25.91,10.18,124.75,124.75,0,0,0-15.24,8.38c-6,3.72-11.75,7.82-17.6,11.76a11.85,11.85,0,0,0-1.25,1.1c4.9-2.51,9.81-4.75,14.22-7.73,7.11-4.8,15.11-7.6,22.89-10.84a131.62,131.62,0,0,1,17.49-5.66c8.27-2.13,16.67-3.84,25-5.58l4.8,2.2,1.43-10.08Z'
            />
          </clipPath>
          <clipPath id='mb-clip-path-3' transform='translate(1.54 1.89)'>
            <path
              id='core-p1-clip'
              className='mb-cls-1'
              d='M207.54,138.36c2.21,2.84,4.08,5.15,5.84,7.54,1.51,2,3,4.13,4.32,6.31,1.73,2.92,3.2,6,4.9,8.93,4.08,7.07,4.63,14.88,4.67,22.73,0,7.08-.11,14.31-3.42,20.75s-6.62,12.77-11,18.3c-3.13,4-6.27,8.26-11.16,10.78-3.33,1.72-5.8,5.1-9.13,6.79a136.88,136.88,0,0,1-19.4,8.3c-4.48,1.45-9.45,1.39-14.78,2.07,2.15-3.3,3.84-5.91,5.54-8.51l-.62-.68c-1.89.11-3.78.29-5.68.32-5.91.07-11.82.13-17.74.13-8.49,0-16.11-2.9-23.35-7.09-4.74-2.74-9.38-5.78-14.41-7.87-7-2.9-14.22-5-22.06-7.72l10.45-4.33c-2.59-1.62-4.83-3.19-7.21-4.48-6.61-3.56-14-4.09-21.22-5.18a123.15,123.15,0,0,0-28.39-1.18c-1.56.12-3.13,0-5.22,0,.8-.92,1.36-1.55,1.91-2.2,4-4.72,8.39-9.22,12.05-14.23,5.23-7.15,10-14.63,14.89-22.05,4-6.17,8-12.38,11.76-18.71,3.43-5.77,6.46-11.76,9.82-17.57,1.86-3.23,4.12-6.23,6-9.44a40.77,40.77,0,0,0,2.86-6c1.27-3.24,2.29-3.59,4.72-1.23,1.6,1.56,2.93,3.42,4.61,4.88,3.69,3.19,7.51,6.24,11.32,9.29a10,10,0,0,0,2.6,1.45c3.19,1.26,4.26,1,6.06-1.87,2.62-4.21,5.13-8.51,7.48-12.87,4.7-8.7,9.44-17.37,13.83-26.22,4.06-8.18,7.65-16.58,11.51-24.85,1.62-3.46,3.39-6.85,5.13-10.26a8.47,8.47,0,0,1,1-1.27c2.42,4.15,4.76,8.12,7.05,12.13q4.95,8.64,9.83,17.32c2.16,3.83,4.21,7.72,6.45,11.49,2.42,4.09,3,4.33,7.14,2.23a37,37,0,0,0,5.64-4c3.26-2.53,6.43-5.18,9.73-7.65a2.19,2.19,0,0,1,2,.4c2.16,2.26,4.09,4.75,6.28,7,4.58,4.66,9.26,9.22,13.91,13.8,2.59,2.55,5.18,5.1,7.87,7.54,1.75,1.58,3.68,3,5.39,4.71-4.21.13-8.29,1.49-11.9-2.53-4.3-4.77-9.37-8.85-14.11-13.23a9.28,9.28,0,0,0-.69-.71c-1.3-.94-1.4-3.6-3.82-2.85a40.71,40.71,0,0,0-4.51,2c-.37.17-.71.41-1,.57a40.13,40.13,0,0,0-3.84-4.13,2.85,2.85,0,0,0-2.65-.24c-4.42,3.06-8.71,6.3-13.6,9.89-1.95-2.67-4.16-5.61-6.27-8.61-2.3-3.25-4.52-6.56-6.75-9.86-1.1-1.63-2.25-3.24-3.19-5s-1.76-2.36-3.45-1.09c-2,1.55-4.18,3-6.13,4.64-1.7,1.44-3.09,1.65-4.68-.13a34.93,34.93,0,0,0-3.4-2.9c-1.76,3.44-3.39,6.5-4.9,9.61-2.65,5.43-5.08,11-7.88,16.32-3.8,7.25-7.86,14.36-11.82,21.53a74.07,74.07,0,0,1-3.91,6.91c-2.29,3.24-3.33,3.26-6.37.87q-4.11-3.24-8.27-6.41c-3.27-2.5-5.72-2.49-9,0-1.59,1.19-3.15,2.41-5.07,3.88l-2.85-3.66c-.92-1.17-1.72-1.53-2.54.17-2.21,4.54-4.4,9.09-6.78,13.55-1.91,3.58-4.1,7-6.17,10.53-.38.64-.83,1.24-1.19,1.89-2.7,4.94-5.28,9.94-8.1,14.8-3.25,5.58-6.59,11.11-10.11,16.51a83.64,83.64,0,0,1-5.77,7.16c-.62.76-1.3,1.47-2.34,2.63,1.34.07,2.19.13,3,.14,5.16.06,10.33.07,15.49.17,8.68.17,16.56,3.35,24.45,6.53,4.6,1.86,9.25,3.62,13.88,5.43.76.3,1.5.68,2.3,1-.76,3.7-5,3.42-6.87,6.31,2.94,1.24,5.69,2.3,8.36,3.54,6.78,3.14,13.43,6.58,20.3,9.5,8.21,3.49,16.93,4.15,25.72,3.39,6.55-.57,13.06-1.52,19.58-2.36,2.92-.38,3.71.24,3.42,3.16a16.34,16.34,0,0,1-.68,3.16c-.29.93-.73,1.8-1.29,3.13,3-.82,5.86-1.12,8.23-2.31A179.42,179.42,0,0,0,198,229.14a38.9,38.9,0,0,0,9.25-8.63c5.77-7.41,10.22-15.47,12.32-24.9,2.4-10.78.91-21.05-2.51-31.15-1.22-3.58-3.92-6.67-6-10a29,29,0,0,0-3.47-5.13c-3.09-3.11-6.38-6-9.73-8.87a4.21,4.21,0,0,0-3.16-.8Z'
            />
          </clipPath>
          <clipPath id='mb-clip-path-4' transform='translate(1.54 1.89)'>
            <path
              id='frame-clip'
              className='mb-cls-1'
              d='M289.36,159.78q0,25.25,0,50.49a51,51,0,0,1-3.45,19.3c-2.87,7.08-6.76,13.86-12.34,19.16-4.69,4.46-9.6,8.82-15.9,11.25-2.58,1-4.75,3-7.19,4.43-3.74,2.16-7.62,4.1-11.34,6.28-7.57,4.45-15,9.11-22.62,13.48-6.68,3.84-13.58,7.28-20.25,11.12-7.83,4.51-15.35,9.59-23.3,13.85a58.57,58.57,0,0,1-28.4,7.33,59.32,59.32,0,0,1-29.23-8.06c-7.07-4-13.92-8.42-20.94-12.54-4.42-2.6-9-5-13.45-7.48q-12.12-6.83-24.21-13.72Q46.9,269,37.15,263.28c-5-3-10.36-5.67-14.9-9.31C17.56,250.21,12.77,246,9.62,241,3.71,231.65-.14,221.55,0,209.86c.44-34.49.36-69,.06-103.48C-.06,92,5.63,80.2,14.54,69.69a40.53,40.53,0,0,1,14.34-11.3c3.31-1.48,6.22-3.82,9.36-5.68,5.63-3.33,11.26-6.67,17-9.87C62,39,68.9,35.45,75.68,31.64,81.84,28.18,87.92,24.6,94,21c6.9-4.1,13.63-8.5,20.64-12.39,15.63-8.67,32.08-11.55,49.18-5.06a76.69,76.69,0,0,1,19.39,10.52,16.82,16.82,0,0,0,1.91,1.17c5.17,3,10.32,6,15.52,8.88,7.3,4.1,14.67,8.09,22,12.22,6.49,3.67,12.9,7.47,19.34,11.23,8.57,5,17.51,9.52,25.56,15.27,4.61,3.29,9.45,7,11.83,12.8.89,2.18,2.63,4,3.85,6.05,4.71,7.89,6.12,16.61,6.16,25.61C289.41,124.79,289.36,142.28,289.36,159.78Zm-6.84-1.36c0-15.58,0-31.16,0-46.74a66.29,66.29,0,0,0-2.93-20.85c-2.35-7.35-6.92-12.94-11.62-18.51-2.33-2.75-5.69-4.74-8.83-6.69-5.61-3.51-11.39-6.74-17.11-10.07-6.89-4-13.75-8.07-20.69-12-6.42-3.62-13-7-19.42-10.6-6.06-3.4-12-7-18-10.47-.28-.17-.51-.43-.8-.6-6.86-3.9-13.49-8.29-20.63-11.58-9-4.15-18.69-3.47-28.26-2.28C126.53,9,120.54,14,113.88,17.2c-7.71,3.74-14.8,8.76-22.25,13.09C84.47,34.45,77.17,38.38,70,42.5,63.51,46.2,57.12,50,50.68,53.79c-6.79,4-13.54,8-20.41,11.86C20.23,71.26,14,80.15,9.92,90.4a46.32,46.32,0,0,0-2.78,16.36C6.89,137.34,7,167.92,7,198.49,7,206,7,213.41,8.29,220.89c1.52,8.43,6.39,14.84,11.2,21.35s12.05,9.52,18.58,13.52c8.33,5.11,17,9.73,25.48,14.53,4.55,2.56,9.18,5,13.68,7.6,7.51,4.4,14.88,9.06,22.42,13.4,7,4,14.4,7.57,21.32,11.8a46,46,0,0,0,18.71,6.34c12.25,1.54,23.12-2.53,33.49-8.34,7.07-4,13.85-8.46,20.89-12.5,7.47-4.29,15.12-8.29,22.65-12.5,5.7-3.19,11.33-6.52,17-9.81,5.09-3,10.19-5.91,15.25-8.92,3.56-2.12,7.1-4.31,10.6-6.54a35.52,35.52,0,0,0,6.1-4.25c6.06-6,11.28-12.36,13.95-20.84a58.5,58.5,0,0,0,2.94-17.81Q282.49,183.17,282.52,158.42Z'
            />
          </clipPath>
        </defs>
        <g id='core'>
          <g id='core-p3'>
            <g className='mb-cls-2'>
              <polyline
                id='core-p3-stroke'
                className='mb-cls-3'
                points='193.09 137.93 218.43 135.73 241.8 137.93 253.91 139.39'
              />
            </g>
          </g>
          <g id='core-p2'>
            <g className='mb-cls-4'>
              <polyline
                id='core-p2-stroke'
                className='mb-cls-5'
                points='206.33 138.26 194.22 138.26 176.48 143.33 154.52 150.37 146.23 154.31 114.15 171.4'
              />
            </g>
          </g>
          <g id='core-p1'>
            <g className='mb-cls-6'>
              <polyline
                id='core-p1-stroke'
                className='mb-cls-7'
                points='238.88 121.37 218.15 102.5 204.07 88.99 205.76 96.03 199.41 90.96 183.52 101.94 167.75 78.85 156.77 59.14 162.97 77.73 154.8 65.06 159.54 79.98 151.7 70.41 155.65 83.64 148.89 76.6 134.44 105.32 116.6 135.73 91.45 119.12 97.36 127.56 88.92 122.78 93.42 131.59 86.1 127 74.28 148.4 61.6 169.51 51.19 185.56 35.98 203.3 44.71 203.3 66.95 203.3 90.04 210.91 99.9 214.28 89.76 221.04 97.64 223.01 110.03 228.64 124.11 236.25 130.87 237.93 139.88 239.91 155.08 239.91 170.57 237.65 166.06 249.2 174.79 247.23 186.62 242.44 199.41 234.27 205.76 230.05 213.37 220.76 218.72 212.31 224.54 200.77 225.75 190.07 225.75 179.93 223.22 169.51 219.56 160.12 211.68 148.96 201.26 136.85'
              />
            </g>
          </g>
        </g>
        <g id='frame'>
          <g className='mb-cls-8'>
            <path
              id='frame-stroke'
              className='mb-cls-9'
              d='M144.69,3.2a45.16,45.16,0,0,0-9.73,1,92.49,92.49,0,0,0-13.52,5.07c-12.91,6.06-37.19,21.17-49.55,28.3C60,44.4,35.67,57.26,24.44,65.14a47.08,47.08,0,0,0-5.2,4.36,75.76,75.76,0,0,0-6.06,7.75A91.83,91.83,0,0,0,7.83,86.4a56.75,56.75,0,0,0-3.24,8.72,89.48,89.48,0,0,0-1,11.69c-.34,8.16,0,24.5,0,32.66v36c0,5.38-.09,16.16,0,21.54.07,4.44.06,13.33.56,17.74.21,1.82,1,5.4,1.41,7.18a79.8,79.8,0,0,0,2.53,8.59A70.21,70.21,0,0,0,12.2,238c1.45,2.33,4.42,7,6.33,9,2.27,2.35,7.69,6.08,10.42,7.88,21.48,14.18,66.7,39,89.39,51.1,1.39.75,4.18,2.22,5.64,2.82a75.2,75.2,0,0,0,7.6,2.53,63.5,63.5,0,0,0,7.6,1.41,63.59,63.59,0,0,0,7,0,86.4,86.4,0,0,0,10.28-1.13,76.52,76.52,0,0,0,10-3.23c2.89-1.21,8.38-4.27,11.12-5.78,14-7.69,41.43-24,55.19-32.09,8.3-4.89,25.35-14,33.08-19.71a64.18,64.18,0,0,0,6.34-5.77,69.81,69.81,0,0,0,6.33-8,66.47,66.47,0,0,0,4-8.45,77.58,77.58,0,0,0,2.5-8.16,46.36,46.36,0,0,0,1-6.62c.89-27,.05-79.77,0-106.57a61,61,0,0,0-.56-6.33c-.34-2.42-1.19-7.23-1.83-9.58a59.06,59.06,0,0,0-2.53-7,81.37,81.37,0,0,0-4.79-8.16,51.52,51.52,0,0,0-5.49-7c-1.67-1.53-5.67-3.74-7.6-4.93C246.43,53.89,212.1,34.7,195.07,24.88,187.39,20.45,172.38,11,164.38,7.14,163,6.46,160,5.38,158.47,4.88a45.32,45.32,0,0,0-5.92-1.68,51.09,51.09,0,0,0-5.49,0'
              transform='translate(1.54 1.89)'
            />
          </g>
        </g>
      </svg>
    </div>
  );
};

MountbirchLogoAnimation.propTypes = {
  client: PropTypes.object.isRequired,
};

const mapStateToProps = (state) => ({
  client: state.client,
});

export default connect(mapStateToProps, { endLoaderAnimation })(
  MountbirchLogoAnimation
);
